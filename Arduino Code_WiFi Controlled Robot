//Arduino Code: WiFi Controlled Robot

#include <SoftwareSerial.h>

SoftwareSerial ESP8266(0, 1); //TX, RX respetively
String readvoice;

// MOTOR 1
int motor1Pin1 = 6;
int motor1Pin2 = 7;

// MOTOR 2
int motor2Pin1 = 8;
int motor2Pin2 = 9;

int ENA = 5;
int ENB = 10;

int speedval = 200;

//Ultrasonic Sensor
int trig = 2;
int echo = 3;
long duration, inches, cm;

void setup()
{
  Serial.begin(9600);
 
  ESP8266.begin(9600);
 
  pinMode(motor1Pin1, OUTPUT);
  pinMode(motor1Pin2, OUTPUT);
 
  pinMode(motor2Pin1, OUTPUT);
  pinMode(motor2Pin2, OUTPUT);

  pinMode(ENA, OUTPUT);
  pinMode(ENB, OUTPUT);
    analogWrite(ENA, speedval);
    analogWrite(ENB, speedval);

  pinMode(trig, OUTPUT);
  pinMode(echo, INPUT);
}

void loop()
{
  while (ESP8266.available()){  //Check if there is an available byte to read
  delay(10); //Delay added to make thing stable
  char c = ESP8266.read(); //Conduct a serial read
  readvoice += c; //build the string- "forward", "reverse", "left" and "right"
  }
 
  if (readvoice.length() > 0) {
    Serial.print(readvoice);

  if((readvoice == "f"))//  && (cm > 10))
  {
    delay(200);
   
    digitalWrite(trig, LOW);
    delayMicroseconds(2);
    digitalWrite(trig, HIGH);
    delayMicroseconds(5);
    digitalWrite(trig, LOW);
   
    duration = pulseIn(echo, HIGH);
    //this returns the time duration taken
    //for the ultrasonics to hit an obstacle and return
   
    inches = duration / 74 / 2;//converts the time duration into inches
    cm = duration / 29 / 2;//converts the time duration to cm
    delay(100);
   
    if(cm > 10)
    {
      digitalWrite(motor1Pin1, HIGH);
      digitalWrite(motor1Pin2, LOW);
      digitalWrite(motor2Pin1, HIGH);
      digitalWrite(motor2Pin2, LOW);
      delay(300);
    }
  }

  else if((readvoice == "b"))// && (cm > 10))
  {
    delay(200);
   
    digitalWrite(trig, LOW);
    delayMicroseconds(2);
    digitalWrite(trig, HIGH);
    delayMicroseconds(5);
    digitalWrite(trig, LOW);
   
    duration = pulseIn(echo, HIGH);
    //this returns the time duration taken
    //for the ultrasonics to hit an obstacle and return
   
    inches = duration / 74 / 2;//converts the time duration into inches
    cm = duration / 29 / 2;//converts the time duration to cm
    delay(100);
   
    if(cm > 10)
    {
      digitalWrite(motor1Pin1, LOW);
      digitalWrite(motor1Pin2, HIGH);
      digitalWrite(motor2Pin1, LOW);
      digitalWrite(motor2Pin2, HIGH);
      delay(300);
    }
  }
 
  else if((readvoice == "l"))// && (cm > 10))
  {
    delay(200);
   
    digitalWrite(trig, LOW);
    delayMicroseconds(2);
    digitalWrite(trig, HIGH);
    delayMicroseconds(5);
    digitalWrite(trig, LOW);
   
    duration = pulseIn(echo, HIGH);
    //this returns the time duration taken
    //for the ultrasonics to hit an obstacle and return
   
    inches = duration / 74 / 2;//converts the time duration into inches
    cm = duration / 29 / 2;//converts the time duration to cm
    delay(100);
   
    if(cm > 10)
    {
      digitalWrite(motor1Pin1, LOW);
      digitalWrite(motor1Pin2, HIGH);
      digitalWrite(motor2Pin1, HIGH);
      digitalWrite(motor2Pin2, LOW);
      delay(300);
    }
  }

  else if((readvoice == "r"))// && (cm > 10))
  {
    delay(200);
   
    digitalWrite(trig, LOW);
    delayMicroseconds(2);
    digitalWrite(trig, HIGH);
    delayMicroseconds(5);
    digitalWrite(trig, LOW);
   
    duration = pulseIn(echo, HIGH);
    //this returns the time duration taken
    //for the ultrasonics to hit an obstacle and return
   
    inches = duration / 74 / 2;//converts the time duration into inches
    cm = duration / 29 / 2;//converts the time duration to cm
    delay(100);
   
    if(cm > 10)
    {
      digitalWrite(motor1Pin1, HIGH);
      digitalWrite(motor1Pin2, LOW);
      digitalWrite(motor2Pin1, LOW);
      digitalWrite(motor2Pin2, HIGH);
      delay(300);
    }
  }

  else if(readvoice == "s")
  {    
    digitalWrite(motor1Pin1, LOW);
    digitalWrite(motor1Pin2, LOW);
    digitalWrite(motor2Pin1, LOW);
    digitalWrite(motor2Pin2, LOW);
    delay(300);
  }
 
  else
  {
    Serial.println("Wrong Input");
  }
 
  readvoice="";  //Reset the variable
 
  }
}